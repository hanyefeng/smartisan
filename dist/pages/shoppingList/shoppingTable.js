"use strict";function _classCallCheck(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}}function _createClass(a,t,e){return t&&_defineProperties(a.prototype,t),e&&_defineProperties(a,e),a}var shoppingTable=function(){function s(a,t,e){_classCallCheck(this,s),this.data=a,this.localData=t,this.parent=e,this.boxInner=this.createShopBox(),this.bottomFix=this.createBottomFix()}return _createClass(s,[{key:"createShopBox",value:function(){var a=$("<div>");a.addClass("box-inner");var t=$("<div>"),e=$("<div>");e.addClass("cart-table-title");for(var s=["商品信息","操作","小计","数量","单价"],d=["name","operation","subtotal","num","price"],o=0;o<s.length;o++){var n=$("<span>");n.text(s[o]),n.addClass(d[o]),n.appendTo(e)}e.appendTo(t);var i=$("<div>");i.addClass("cart-table");var l=$("<div>");l.addClass("item-list");var r=$("<div>");return r.addClass("cart-group"),this.createShopList(r),r.appendTo(l),l.appendTo(i),i.appendTo(t),t.appendTo(a),a.appendTo(this.parent),a}},{key:"createShopList",value:function(a){for(var t in this.localData){for(var e=null,s=0;s<this.data.length;s++)if(this.data[s].id==t){e=s;break}var d=$("<div>");d.addClass("divide");var o=$("<div>");o.addClass("cart-items");var n=$("<div>");n.addClass("cart-item");var i=$("<div>");i.addClass("checkbox-container");var l=$("<span>");l.addClass("m-blue-checkbox-new").addClass("checkbox-on"),l.attr("goodsId",t),l.on("click",this.checkHandler.bind(this)),l.appendTo(i),i.appendTo(n);var r=$("<div>");r.addClass("item-wrapper");var p=$("<div>");p.addClass("items-thumb");var h=$("<img>");h.attr("src",this.data[e].shop_info.ali_image),h.appendTo(p),p.appendTo(r);var c=$("<div>");c.addClass("name").addClass("hide-row");var v=$("<div>");v.addClass("name-table");var u=$("<a>");u.text(this.data[e].shop_info.title),u.appendTo(v);var b=$("<ul>");for(var C in b.addClass("attribute").addClass("clear_fix"),this.data[e].attr_info){var m=$("<li>");m.text(this.data[e].attr_info[C].value),m.appendTo(b)}b.appendTo(v),v.appendTo(c),c.appendTo(r);var T=$("<div>");T.addClass("operation");var g=$("<a>");g.addClass("items-delete-btn"),g.attr("goodsId",t),g.on("click",this.delBtnHanlder.bind(this)),g.appendTo(T),T.appendTo(r);var x=$("<div>"),f=$("<div>");f.addClass("subtotal");var k=$("<i>");k.text("￥"),k.appendTo(f);var y=$("<span>");y.text(num2money(this.data[e].price*this.localData[this.data[e].id].num)+".00"),y.appendTo(f),f.appendTo(x);var _=$("<div>");_.addClass("item-cols-num");var B=$("<div>");B.addClass("quantity"),B.attr("goodsId",t);var I=this.localData[this.data[e].id].num,w=$("<span>");w.text("-"),w.addClass("button").addClass("down"),I<=1&&w.addClass("disabled"),w.on("click",this.numChangeBtn.bind(this)),w.appendTo(B);var D=$("<span>");D.addClass("num"),D.text(I),D.appendTo(B);var E=$("<span>");E.text("+"),E.addClass("button").addClass("up"),10<=I&&E.addClass("disabled"),E.on("click",this.numChangeBtn.bind(this)),E.appendTo(B),B.appendTo(_),_.appendTo(x);var G=$("<div>");G.addClass("price");var N=$("<i>");N.text("￥"),N.appendTo(G);var S=$("<span>");S.text(num2money(this.data[e].price)+".00"),S.appendTo(G),G.appendTo(x),x.appendTo(r),r.appendTo(n),n.appendTo(o),o.appendTo(d),d.appendTo(a)}}},{key:"createBottomFix",value:function(){var a=$("<div>");a.addClass("cart-bottom-bg").addClass("fix-bottom"),a.attr("id","cart_bottom");var t=$("<div>");t.addClass("fix-bottom-inner");var e=$("<div>");e.addClass("cart-bar-operation");var s=$("<div>");s.addClass("choose-all"),this.allChooseBtn=$("<span>"),this.allChooseBtn.addClass("m-blue-checkbox-new").addClass("checkbox-on"),this.allChooseBtn.on("click",this.checkHandler.bind(this)),this.allChooseBtn.appendTo(s);var d=$("<span>");d.addClass("text-choose-all"),d.text("全选"),d.appendTo(s),s.appendTo(e);var o=$("<div>");o.addClass("delete-choose-goods"),o.on("click",this.delChooseGoodsEvent.bind(this)),o.text("删除选中的商品"),o.appendTo(e),e.appendTo(t);var n=$("<div>");n.addClass("shipping");var i=$("<div>");i.addClass("shipping-box");var l=$("<div>");l.addClass("shipping-total").addClass("shipping-num");var r=0;for(var p in this.localData)r+=this.localData[p].num;var h=$("<h4>");h.addClass("highlight"),$("<b>已选择 </b>").appendTo(h),this.selectGoodsNum=$("<i>"),this.selectGoodsNum.text(r),this.selectGoodsNum.appendTo(h),$("<b> 件商品</b>").appendTo(h),h.appendTo(l);var c=$("<h5>");c.html("共计 "),this.allGoodsNum=$("<i>"),this.allGoodsNum.text(r),this.allGoodsNum.appendTo(c),c.html(c.html()+" 件商品"),c.appendTo(l),l.appendTo(i);var v=$("<div>");v.addClass("shipping-total").addClass("shipping-price");var u=0;for(var b in this.localData)for(var C=0;C<this.data.length;C++)if(this.data[C].id==b){u+=this.localData[b].num*this.data[C].price;break}var m=$("<h4>");m.addClass("highlight"),m.text(" 应付金额："),$("<span>").text("￥").appendTo(m);var T=$("<i>").appendTo(m);this.priceAll=$("<span>").appendTo(T),this.priceAll.text(num2money(u)+".00"),m.appendTo(v);var g=$("<h5>");g.addClass("shipping-tips"),g.text("应付总额不含运费"),g.appendTo(v),v.appendTo(i),i.appendTo(n);var x=$("<span>");x.addClass("jianguo-blue-main-btn").addClass("big-main-btn");var f=$("<a>");return f.text("现在购买"),f.appendTo(x),x.appendTo(n),n.appendTo(t),t.appendTo(a),a.appendTo(this.parent),a}},{key:"checkHandler",value:function(a){if($(a.currentTarget).is(".checkbox-on")?$(a.currentTarget).removeClass("checkbox-on"):$(a.currentTarget).addClass("checkbox-on"),$(a.currentTarget).attr("goodsId")){var t=0;$(".m-blue-checkbox-new").each(function(){$(this).attr("goodsId")&&$(this).is(".checkbox-on")&&t++}),t==$(".m-blue-checkbox-new").length-1?this.allChooseBtn.addClass("checkbox-on"):this.allChooseBtn.removeClass("checkbox-on")}else $(a.currentTarget).is(".checkbox-on")?$(".m-blue-checkbox-new").addClass("checkbox-on"):$(".m-blue-checkbox-new").removeClass("checkbox-on");this.bottomChange()}},{key:"bottomChange",value:function(){var t=0,e=0,s=this;$(".m-blue-checkbox-new").each(function(){if($(this).attr("goodsId")&&$(this).is(".checkbox-on")){t+=s.localData[$(this).attr("goodsId")].num,console.log(t);for(var a=0;a<s.data.length;a++)s.data[a].id==$(this).attr("goodsId")&&(e+=s.localData[$(this).attr("goodsId")].num*s.data[a].price)}}),this.selectGoodsNum.text(t),this.priceAll.text(num2money(e)+".00")}},{key:"delBtnHanlder",value:function(a){delete this.localData[$(a.currentTarget).attr("goodsId")],this.refreshEvent()}},{key:"delChooseGoodsEvent",value:function(){var a=this;$(".m-blue-checkbox-new").each(function(){$(this).attr("goodsId")&&$(this).is(".checkbox-on")&&delete a.localData[$(this).attr("goodsId")]}),this.refreshEvent()}},{key:"numChangeBtn",value:function(a){if(!$(a.currentTarget).is(".disabled")){var t=$(a.currentTarget).parent().attr("goodsId");$(a.currentTarget).is(".down")?this.localData[t].num--:this.localData[t].num++,this.refreshEvent()}}},{key:"refreshEvent",value:function(){localStorage.setItem("shoppingList",JSON.stringify(this.localData));var a=new Event(s.REFRESH_SHOPPING_TABLE);a.data=this.localData,console.log(a.data),document.dispatchEvent(a)}}],[{key:"REFRESH_SHOPPING_TABLE",get:function(){return"refresh_shopping_table"}}]),s}();