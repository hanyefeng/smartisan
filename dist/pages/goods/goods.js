"use strict";function _defineProperty(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}require(["../../static/conf/config.js"],function(){require(["jquery","sw"],function(l,t){require(["../../scripts/common/common"],function(){if(getCookie("userinfo")){var t=JSON.parse(getCookie("userinfo")).username.replace(/(.{3}).*(.{4})/,"$1******$2");l(".nav-user-avatar dt").text("+86 "+t)}else;if("{}"!=localStorage.getItem("shoppingList")&&localStorage.getItem("shoppingList")){l("<span>").addClass("cart-tip").addClass("cart-num").appendTo(".nav-cart>a");var e=JSON.parse(localStorage.getItem("shoppingList")),o="";for(var a in e)o+=a+",";o=o.substr(0,o.length-1),l.ajax({url:"http://localhost:8000/goodinfo?id="+o,success:function(t){var o=JSON.parse(t).data.list;new fullShop(o,e,l(".nav-cart-list>div"))}})}else new EmptyShop(l(".nav-cart-list>div"));l(".nav-user").on("mouseenter",function(){getCookie("userinfo")&&l(".nav-user-wrapper").show()}).on("mouseleave",function(){l(".nav-user-wrapper").hide()}).on("click",function(){getCookie("userinfo")?location.href="http://localhost:9999/pages/home/home.html":location.href="http://localhost:9999/pages/login/login.html"}),l(".logout").on("click",function(){addCookie("userinfo","",-1),location.href="http://localhost:9999/pages/home/home.html"}),l(".nav-cart").on("mouseenter",function(){l(".nav-cart-wrapper").show()}).on("mouseleave",function(){l(".nav-cart-wrapper").hide()}),l(".nav-cart>a").on("click",function(){location.href="http://localhost:9999/pages/shoppingList/shoppingList.html"});var n=i(location.search),s=n.substr(0,n.length-2);function i(t){return t.split("=")[1]}var r={};l.ajax({url:"http://localhost:8000/goods?ids="+s,success:function(t){r=JSON.parse(t).data.list[0],document.title=r.name,l.ajax({url:"http://localhost:8000/goodinfo?id="+n,success:function(t){var o=JSON.parse(t).data.list[0];new GoodsInfo(r,o,l(".item-wrapper"))}})}}),document.addEventListener(GoodsInfo.CHANGE_URL_EVENT,function(t){var o={title:"",url:window.location.href};history.pushState(o,"","goods.html?ids="+t.url);var e=i(location.search);l.ajax({url:"http://localhost:8000/goodinfo?id="+e,success:function(t){var o=JSON.parse(t).data.list[0];l(".item-wrapper").empty(),new GoodsInfo(r,o,l(".item-wrapper"))}})}),document.addEventListener(GoodsInfo.ADD_SHOPPINGLIST_EVENT,function(t){var o=String(t.id),e=Number(t.num),a=localStorage.getItem("shoppingList");if(a){var n=JSON.parse(a);if(n[o]){if(10<n[o].num+e)return l(".toast-tips").addClass("on").children("label").text("失败，超过数量限制"),void setTimeout(function(){l(".toast-tips").removeClass("on")},1e3);n[o].num+=e,localStorage.setItem("shoppingList",JSON.stringify(n))}else n[o]={id:o,num:e},localStorage.setItem("shoppingList",JSON.stringify(n))}else localStorage.setItem("shoppingList",JSON.stringify(_defineProperty({},o,{id:o,num:e})));l(".toast-tips").addClass("on").children("label").text("已添至购物车"),setTimeout(function(){l(".toast-tips").removeClass("on")},1e3),l(".nav-cart-list>div").empty(),l("<span>").addClass("cart-tip").addClass("cart-num").appendTo(".nav-cart>a");var s=JSON.parse(localStorage.getItem("shoppingList")),i="";for(var r in s)i+=r+",";i=i.substr(0,i.length-1),l.ajax({url:"http://localhost:8000/goodinfo?id="+i,success:function(t){var o=JSON.parse(t).data.list;new fullShop(o,s,l(".nav-cart-list>div"))}})})})})});